specVersion: 1.3.0
features:
  - ipfs
  - nonDeterministicIpfs
indexerHints:
  prune: auto

description: Subgraph Alchemy pour indexer les marchés Makao
repository: https://github.com/makao-team/makao-subgraph

schema:
  file: ./schema.graphql

dataSources:
  - kind: ethereum
    name: EventContractInstance
    network: sepolia # Changez selon votre réseau (mainnet, polygon, etc.)
    source:
      address: "0x5accdde8c2137B231d5cFEbc80Ccc52E9A200674" # Remplacez par l'adresse de votre factory
      abi: EventContractInstance
      startBlock: 4500000 # Remplacez par le bloc de déploiement du contrat
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Market
        - User
        - GlobalStat
      abis:
        - name: EventContractInstance
          file: ./abis/EventContractInstance.json
        - name: MakaoFixture
          file: ./abis/MakaoFixture.json
      eventHandlers:
        - event: CreateInstance(indexed address,bytes)
          handler: handleCreateInstance
      file: ./src/mappings/factory.ts

templates:
  - kind: ethereum
    name: MakaoFixture
    network: sepolia # Même réseau que la datasource principale
    source:
      abi: MakaoFixture
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Market
        - Challenge
        - Engagement
        - Collection
        - User
        - GlobalStat
        - MarketEvent
      abis:
        - name: MakaoFixture
          file: ./abis/MakaoFixture.json
      eventHandlers:
        - event: EngageChallenge(address,uint256,uint256)
          handler: handleEngageChallenge
        - event: EventCancelled()
          handler: handleEventCancelled
        - event: ExitEvent(indexed address,address,uint256)
          handler: handleExitEvent
        - event: ResolveEvent(uint256[])
          handler: handleResolveEvent
      file: ./src/mappings/market.ts
